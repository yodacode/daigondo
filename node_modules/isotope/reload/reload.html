<html>
    <head>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>

        <link rel="stylesheet" type="text/css" href="modules/css/header.css">
        <link rel="stylesheet" type="text/css" href="modules/css/button.css">
        <script>
            add_row = function(name, state){
                var inject = "<tr><td>"+name +"</td>"+
                                 "<td id=\"" + name + "_state\">"+state+"</td>"+
                                 "<td><a onclick=\"reload('"+name+"')\" class=\"green\">reload</a></td>"+
                                 "<td><a onclick=\"unload('"+name+"')\" class=\"red\">unload</a></td>"+
                             "</tr>";
                document.getElementById('table').innerHTML += inject;
            }

            mark_status = function(name, state){
                document.getElementById(name+'_state').innerHTML = state;
            }

            reload = function(name){
                $.get("modules/refresh/"+name, function(data){
                    if (data == "success"){
                        mark_status(name, "enabled");
                    }
                });
            }

            unload = function(name){
                $.get("modules/unload/"+name, function(data){
                    if (data == "success"){
                        mark_status(name, "disabled");
                    }
                });
            }

            init = function(){
                $.get("modules/get/all", function(data){
                    data.forEach(function(a){
                        if (a.name != "reload"){
                            add_row(a.name, a.state=="loaded"?"enabled":"disabled");
                        }
                    })
                });
            }
        </script>
    </head>
    <body onload="init()">
        <table id = "table">
            <tr>
                <th colspan="4">modules</th>
            </tr>
        </table>
    </body>
</html>
